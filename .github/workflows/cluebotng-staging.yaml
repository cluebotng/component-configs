name: 'Execute deployment for cluebotng-staging'
on: { push: { branches: [ main ], paths: [ 'cluebotng-staging.yaml', 'config/network-policies/cluebotng-staging.yaml', 'config/web-services/cluebotng-staging.yaml', '.github/workflows/cluebotng-staging.yaml' ] } }
jobs:
  update-config:
    runs-on: ubuntu-latest
    concurrency:
      group: cluebotng-staging-update-config
    steps:
      - uses: actions/checkout@v4
      - uses: cluebotng/ci-execute-fabric@main
        with:
          user: 'cluebotng-staging'
          task: setup
          ssh_key: ${{ secrets.CI_SSH_KEY }}
  deploy:
    runs-on: ubuntu-latest
    concurrency:
      group: cluebotng-staging-deploy
    #environment: 'cluebotng-staging'
    needs: [update-config]
    steps:
      - uses: actions/checkout@v4
      - uses: cluebotng/ci-execute-fabric@main
        with:
          user: 'cluebotng-staging'
          task: execute-deploy
          ssh_key: ${{ secrets.CI_SSH_KEY }}
      # - uses: cluebotng/ci-toolforge-deploy@main
      #   with:
      #      tool: 'cluebotng-staging'
      #     token: '${{ secrets.TOOLFORGE_DEPLOY_TOKEN }}'
