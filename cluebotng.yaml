components:
  # Core services - see utilities repo (until components-api is stable)

  # Supporting services
  redis:
    build:
      repository: https://github.com/cluebotng/external-redis.git
      ref: refs/tags/v1.0.0
      use_latest_versions: true
    run:
      command: redis-server
      port: 6379
  # Report interface
  report-interface:
    build:
      repository: https://github.com/cluebotng/report.git
      ref: refs/tags/1.2.3
      use_latest_versions: true
    run:
      command: web
      port: 8000
      health_check_http: /api/?action=health.check
      replicas: 2
  # Monitoring
  grafana-alloy:
    build:
      repository: https://github.com/cluebotng/external-grafana-alloy.git
      ref: refs/tags/v0.3.2
      use_latest_versions: true
    run:
      command: run-alloy
      port: 8118
      health_check_http: /health
  pushgateway:
    build:
      repository: https://github.com/cluebotng/external-pushgateway.git
      ref: refs/tags/v0.0.2
      use_latest_versions: true
    run:
      command: run-pushgateway
      port: 9091
      health_check_http: /-/healthy
      mount: all
# Note: The important things are managed from the utilities repo, until components is 'stable'
