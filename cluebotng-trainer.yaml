components:
  coordinator:
    build:
      repository: https://github.com/cluebotng/trainer.git
      ref: refs/tags/v1.2.5
      use_latest_versions: true
    run:
      schedule: '13 13,23 * * *'
      mount: none
      # This will trigger other jobs, which in turn will create k8s pods, which will do the actual work
      command: launcher ./deployment/entrypoint.sh run-edit-sets
  file-api:
    build:
      repository: https://github.com/cluebotng/fileserver.git
      ref: refs/tags/v0.0.3
      use_latest_versions: true
    run:
      command: run-fileserver
      port: 8000
      replicas: 2
      health_check_http: /_/health
  # Monitoring
  grafana-alloy:
    build:
      repository: https://github.com/cluebotng/external-grafana-alloy.git
      ref: refs/tags/v0.2.8
      use_latest_versions: true
    run:
      command: run-alloy
      port: 8118
      health_check_http: /health
  pushgateway:
    build:
      repository: https://github.com/cluebotng/external-pushgateway.git
      ref: refs/tags/v0.0.1
      use_latest_versions: true
    run:
      command: run-pushgateway
      port: 9091
      health_check_http: /-/healthy
      mount: all