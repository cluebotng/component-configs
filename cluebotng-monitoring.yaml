components:
  # Core services
  prometheus:
    build:
      repository: https://github.com/cluebotng/monitoring.git
      ref: refs/tags/v2.7.0
      use_latest_versions: true
    run:
      command: run-prometheus
      port: 9090
      health_check_http: /-/healthy
      mount: all
  alertmanager:
    build:
      reuse_from: prometheus
    run:
      command: run-alert-manager
      port: 9093
      health_check_http: /-/healthy
      mount: all
  blackbox-exporter:
    build:
      reuse_from: prometheus
    run:
      command: run-blackbox-exporter
      port: 9115
      replicas: 2
  grafana:
    build:
      reuse_from: prometheus
    run:
      command: run-grafana
      port: 3000
      health_check_http: /api/health
      replicas: 2
  wiki-update-receiver:
    build:
      reuse_from: prometheus
    run:
      command: run-updater
      port: 8900
      health_check_http: /health
      replicas: 2
  checker:
    build:
      repository: https://github.com/cluebotng/monitoring-probes.git
      ref: refs/tags/v1.1.0
      use_latest_versions: true
    run:
      command: run-checker
      port: 8090
      health_check_http: /health
      replicas: 2
  grafana-alloy:
    build:
      repository: https://github.com/cluebotng/external-grafana-alloy.git
      ref: refs/tags/v0.4.2
      use_latest_versions: true
    run:
      command: run-alloy
      port: 8118
      health_check_http: /health
      mount: all
